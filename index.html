<!DOCTYPE html>
<html>
	<head>
		<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-csv/0.71/jquery.csv-0.71.min.js"></script>
		<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
		<script>
			// load in the Google Chart sankey diagram API
			google.charts.load('current', {'packages':['sankey']});
			//google.charts.setOnLoadCallback(generateSankey);

			
			

			function upload() {
				
				var file = document.getElementById("fileUpload").value;
				
				// var data = $.csv.toObjects(file);
				var regex = /^([a-zA-Z0-9\s_\\.\-:])+(.csv|.txt)$/;
        if (regex.test(fileUpload.value.toLowerCase())) {
            if (typeof (FileReader) != "undefined") {
                var reader = new FileReader();
                reader.onload = function (e) {
                    var table = document.createElement("table");
                    var rows = e.target.result.split("\n");

										var headers = [];
										var data = [];
										

                    for (var i = 0; i < rows.length; i++) {
												if (i == 0) {
													headers = rows[i].split(","); 
													console.log(headers);
												}
                        var cells = rows[i].split(",");
												
                        if (cells.length > 1 && i > 0) {
                            //var row = table.insertRow(-1);
                            var row = {};
														for (var j = 0; j < cells.length; j++) {
                                //var cell = row.insertCell(-1);
                                //cell.innerHTML = cells[j];
																//row.push(cells(j));
																//console.log("Headers:",headers[j]);
																//console.log(cells[j]);
																
																row[headers[j]] = cells[j];
                            }
														//console.log(row["Value"]);
														data.push(row);
                        }
                    }
										console.log(data);
                    var dvCSV = document.getElementById("wheat-trade-sankey");
                    dvCSV.innerHTML = "";
                    dvCSV.appendChild(table);
                }
                reader.readAsText(fileUpload.files[0]);
            } else {
                alert("This browser does not support HTML5.");
            }
        } else {
            alert("Please upload a valid CSV file.");
        }
			}

			function generateSankey1() {
				var data = new google.visualization.DataTable();
				data.addColumn('string', 'From');
				data.addColumn('string', 'To');
				data.addColumn('number', 'Weight');
				data.addRows([
				[ 'A', 'X', 5 ],
				[ 'A', 'Y', 7 ],
				[ 'A', 'Z', 6 ],
				[ 'B', 'X', 2 ],
				[ 'B', 'Y', 9 ],
				[ 'B', 'Z', 4 ]
				]);

				// Sets chart options.
				var options = {
				width: 600,
				};

				// Instantiates and draws our chart, passing in some options.
				var chart = new google.visualization.Sankey(document.getElementById('wheat-trade-sankey'));
				chart.draw(data, options);
			}
		</script>
	</head>
	<body>
		<input type="file" id="fileUpload" />
		<input type="button" id="upload" value="Upload" onclick="upload()" />
		<div id="wheat-trade-sankey" style="width:900px; height:400px;" ></div>
	</body>
</html>